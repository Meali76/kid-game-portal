<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monster Match - Memory Game</title>
    <!-- Load Tailwind CSS via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* Base styling for a playful look */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #ffe68a; /* Soft yellow background for fun */
        }
        
        /* Custom styles for the card flip effect */
        .card {
            cursor: pointer;
            perspective: 1000px;
            height: 100%;
            width: 100%;
            position: relative;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            border-radius: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
        }

        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden; /* Safari */
            backface-visibility: hidden;
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
        }

        .card-back {
            background-color: #4f46e5; /* Indigo/Blue back cover */
            color: white;
            border: 4px solid #3730a3;
        }

        .card-front {
            background-color: #fef3c7; /* Light cream front */
            transform: rotateY(180deg);
        }

        /* Adjust grid layout based on level */
        #game-board.level-1 { grid-template-columns: repeat(4, 1fr); max-width: 480px; }
        #game-board.level-2 { grid-template-columns: repeat(4, 1fr); max-width: 480px; }
        #game-board.level-3 { grid-template-columns: repeat(5, 1fr); max-width: 600px; }

        .card-container {
            aspect-ratio: 1 / 1; /* Ensures cards are square */
            padding: 0.5rem;
        }

        .button-primary {
            @apply px-6 py-3 font-bold rounded-full shadow-lg transform transition duration-200 hover:scale-105;
        }
    </style>
</head>
<body class="flex flex-col items-center p-4 min-h-screen">

    <!-- Header and Back Button -->
    <header class="w-full max-w-7xl mb-8 flex justify-between items-center">
        <h1 class="text-4xl font-extrabold text-gray-800">
            üß† Monster Match!
        </h1>
        <a href="../index.html" class="button-primary bg-blue-500 text-white hover:bg-blue-600 text-base">
            &larr; Back to Portal
        </a>
    </header>

    <!-- Game Control and Status Area -->
    <div class="bg-white p-6 md:p-8 rounded-xl shadow-2xl w-full max-w-xl mx-auto mb-8 border-4 border-yellow-500">
        <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">Memory Challenge</h2>
        
        <!-- Level Selector -->
        <div class="flex flex-wrap justify-center gap-4 mb-6">
            <span class="font-semibold text-lg text-gray-700 self-center">Choose Level:</span>
            <button id="level-1" class="button-primary bg-green-500 text-white hover:bg-green-600 text-sm border-2 border-green-700">Easy (6 Pairs)</button>
            <button id="level-2" class="button-primary bg-yellow-500 text-white hover:bg-yellow-600 text-sm border-2 border-yellow-700">Medium (8 Pairs)</button>
            <button id="level-3" class="button-primary bg-red-500 text-white hover:bg-red-600 text-sm border-2 border-red-700">Hard (10 Pairs)</button>
        </div>

        <!-- Status Display -->
        <div class="flex justify-around text-center text-lg font-semibold text-gray-700">
            <div>Flips: <span id="flips-count" class="text-blue-600 font-extrabold">0</span></div>
            <div>Time: <span id="time-count" class="text-blue-600 font-extrabold">0s</span></div>
        </div>

        <div class="mt-6 text-center">
            <button id="start-game" class="button-primary bg-purple-600 text-white hover:bg-purple-700 w-full disabled:opacity-50">
                Start Game!
            </button>
        </div>
    </div>

    <!-- Game Board Container -->
    <div id="game-board" class="grid gap-2 p-2 bg-yellow-500 rounded-3xl shadow-inner w-full mx-auto" style="min-height: 480px;">
        <p class="text-center text-xl text-white font-semibold self-center col-span-full">Select a level and press Start!</p>
    </div>

    <!-- Custom Message Modal (Hidden by Default) -->
    <div id="message-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-8 rounded-xl shadow-2xl border-4 border-blue-500 max-w-sm text-center">
            <div id="message-icon" class="text-6xl mb-4"></div>
            <h4 id="message-title" class="text-3xl font-black text-gray-800 mb-3"></h4>
            <p id="message-text" class="text-lg text-gray-700 mb-6"></p>
            <button id="close-modal" class="button-primary bg-green-500 text-white hover:bg-green-600">
                Play Again
            </button>
        </div>
    </div>

<script>
    // --- GAME STATE VARIABLES ---
    const monsters = ['üëæ', 'üëª', 'üëΩ', 'ü§ñ', 'ü¶ñ', 'ü¶Ñ', 'üêô', 'üê∏', 'üåü', '‚ö°Ô∏è'];
    let currentLevel = 1;
    let boardSize = 12; // Default to Level 1
    let cards = [];
    let flippedCards = [];
    let matchedPairs = 0;
    let isWaiting = false;
    let flips = 0;
    let timerInterval;
    let seconds = 0;

    // --- DOM ELEMENTS ---
    const boardElement = document.getElementById('game-board');
    const flipsCount = document.getElementById('flips-count');
    const timeCount = document.getElementById('time-count');
    const startGameButton = document.getElementById('start-game');
    const levelButtons = [
        document.getElementById('level-1'),
        document.getElementById('level-2'),
        document.getElementById('level-3')
    ];
    const modal = document.getElementById('message-modal');
    const modalCloseButton = document.getElementById('close-modal');
    const messageIcon = document.getElementById('message-icon');
    const messageTitle = document.getElementById('message-title');
    const messageText = document.getElementById('message-text');

    // --- GAME LOGIC FUNCTIONS ---

    // 1. Setup Card Data based on Level
    function setupCards(level) {
        let pairsCount;
        switch(level) {
            case 1: // 3x4 grid
                pairsCount = 6;
                boardSize = 12;
                boardElement.className = 'grid gap-2 p-2 bg-yellow-500 rounded-3xl shadow-inner w-full mx-auto level-1';
                break;
            case 2: // 4x4 grid
                pairsCount = 8;
                boardSize = 16;
                boardElement.className = 'grid gap-2 p-2 bg-yellow-500 rounded-3xl shadow-inner w-full mx-auto level-2';
                break;
            case 3: // 4x5 grid
                pairsCount = 10;
                boardSize = 20;
                boardElement.className = 'grid gap-2 p-2 bg-yellow-500 rounded-3xl shadow-inner w-full mx-auto level-3';
                break;
            default:
                pairsCount = 6;
                boardSize = 12;
                boardElement.className = 'grid gap-2 p-2 bg-yellow-500 rounded-3xl shadow-inner w-full mx-auto level-1';
        }

        const selectedMonsters = monsters.slice(0, pairsCount);
        let cardList = [...selectedMonsters, ...selectedMonsters];
        
        // Shuffle the cards (Fisher-Yates algorithm)
        for (let i = cardList.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [cardList[i], cardList[j]] = [cardList[j], cardList[i]];
        }
        
        cards = cardList.map((monster, index) => ({
            id: index,
            content: monster,
            isFlipped: false,
            isMatched: false
        }));
    }

    // 2. Render the Game Board
    function renderBoard() {
        boardElement.innerHTML = '';
        cards.forEach(card => {
            const cardContainer = document.createElement('div');
            cardContainer.className = 'card-container';
            
            const cardElement = document.createElement('div');
            cardElement.className = 'card ' + (card.isFlipped ? 'flipped' : '');
            cardElement.setAttribute('data-id', card.id);
            cardElement.addEventListener('click', handleCardClick);

            const cardInner = document.createElement('div');
            cardInner.className = 'card-inner';

            const cardBack = document.createElement('div');
            cardBack.className = 'card-back text-4xl';
            cardBack.innerHTML = '‚ùì'; // Question mark for the back

            const cardFront = document.createElement('div');
            cardFront.className = 'card-front';
            cardFront.innerHTML = card.content;

            if (card.isMatched) {
                // Dim matched cards for visual feedback
                cardBack.classList.add('opacity-50', 'bg-gray-400');
                cardElement.classList.remove('cursor-pointer');
                cardElement.removeEventListener('click', handleCardClick);
            }

            cardInner.appendChild(cardBack);
            cardInner.appendChild(cardFront);
            cardElement.appendChild(cardInner);
            cardContainer.appendChild(cardElement);
            boardElement.appendChild(cardContainer);
        });
    }

    // 3. Game Start/Reset Logic
    function initGame() {
        clearInterval(timerInterval);
        setupCards(currentLevel);
        renderBoard();

        // Reset game state
        flippedCards = [];
        matchedPairs = 0;
        flips = 0;
        seconds = 0;
        isWaiting = false;

        flipsCount.textContent = flips;
        timeCount.textContent = '0s';
        
        startGameButton.textContent = 'Restart Game';
        startGameButton.classList.remove('bg-purple-600', 'hover:bg-purple-700');
        startGameButton.classList.add('bg-orange-500', 'hover:bg-orange-600');

        // Start the timer
        timerInterval = setInterval(() => {
            seconds++;
            timeCount.textContent = `${seconds}s`;
        }, 1000);

        // Highlight active level button
        levelButtons.forEach(btn => btn.classList.remove('ring-4', 'ring-offset-2', 'ring-purple-400'));
        levelButtons[currentLevel - 1].classList.add('ring-4', 'ring-offset-2', 'ring-purple-400');
    }

    // 4. Handle a Card Click
    function handleCardClick(event) {
        if (isWaiting || flippedCards.length >= 2) return;

        const cardElement = event.currentTarget;
        const cardId = parseInt(cardElement.getAttribute('data-id'));
        const card = cards.find(c => c.id === cardId);

        if (card.isFlipped || card.isMatched) return;

        // Flip the card
        card.isFlipped = true;
        flips++;
        flipsCount.textContent = flips;
        
        flippedCards.push(card);
        renderBoard(); // Re-render to show flipped state

        if (flippedCards.length === 2) {
            isWaiting = true;
            checkMatch();
        }
    }

    // 5. Check for a Match
    function checkMatch() {
        const [card1, card2] = flippedCards;

        if (card1.content === card2.content) {
            // Match found!
            card1.isMatched = true;
            card2.isMatched = true;
            matchedPairs++;

            // Wait a moment, then clear flipped cards and check win
            setTimeout(() => {
                flippedCards = [];
                isWaiting = false;
                renderBoard(); // Rerender to show matched state (dimmed/removed click listener)
                checkWin();
            }, 500);

        } else {
            // No match, flip back after a delay
            setTimeout(() => {
                card1.isFlipped = false;
                card2.isFlipped = false;
                flippedCards = [];
                isWaiting = false;
                renderBoard(); // Rerender to show cards flipped back
            }, 1000);
        }
    }

    // 6. Check for Win Condition
    function checkWin() {
        const requiredPairs = boardSize / 2;
        if (matchedPairs === requiredPairs) {
            clearInterval(timerInterval);
            showModal('üèÜ Awesome Job!', `You completed Level ${currentLevel} in ${flips} flips and ${seconds} seconds!`, 'green');
            startGameButton.textContent = 'Start New Game';
        }
    }

    // 7. Custom Modal/Message Box (Replaces alert())
    function showModal(title, text, color) {
        messageIcon.innerHTML = title.includes('Awesome') ? 'üåü' : 'üßê';
        messageTitle.textContent = title;
        messageText.textContent = text;
        modal.classList.remove('hidden');
        
        // Update modal button color
        modalCloseButton.classList.remove('bg-green-500', 'hover:bg-green-600', 'bg-red-500', 'hover:bg-red-600');
        modalCloseButton.classList.add(color === 'green' ? 'bg-green-500' : 'bg-red-500');
        modalCloseButton.classList.add(color === 'green' ? 'hover:bg-green-600' : 'hover:bg-red-600');
    }

    // --- EVENT LISTENERS ---
    
    // Level Selection
    levelButtons.forEach((btn, index) => {
        btn.addEventListener('click', () => {
            currentLevel = index + 1;
            startGameButton.textContent = 'Start Game!';
            startGameButton.classList.add('bg-purple-600', 'hover:bg-purple-700');
            startGameButton.classList.remove('bg-orange-500', 'hover:bg-orange-600');
            
            // Re-render an empty board with the correct level sizing
            setupCards(currentLevel);
            boardElement.innerHTML = `<p class="text-center text-xl text-white font-semibold self-center col-span-full">Ready for Level ${currentLevel}?</p>`;
            
            levelButtons.forEach(b => b.classList.remove('ring-4', 'ring-offset-2', 'ring-purple-400'));
            btn.classList.add('ring-4', 'ring-offset-2', 'ring-purple-400');

            clearInterval(timerInterval);
            seconds = 0;
            timeCount.textContent = '0s';
            flipsCount.textContent = '0';
        });
    });

    // Start Button
    startGameButton.addEventListener('click', initGame);

    // Modal Close Button
    modalCloseButton.addEventListener('click', () => {
        modal.classList.add('hidden');
        initGame(); // Automatically restarts the game on the current level
    });
    
    // Initial setup on load
    window.onload = () => {
        levelButtons[0].click(); // Set default level to 1 and highlight it
    };

</script>
</body>
</html>
